<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #999999;
            --tg-theme-link-color: #0088cc;
            --tg-theme-button-color: #0088cc;
            --tg-theme-button-text-color: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            padding: 16px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
            border-bottom: 2px solid var(--tg-theme-link-color);
            padding-bottom: 12px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .header p {
            color: var(--tg-theme-hint-color);
            font-size: 14px;
        }

        .user-info {
            background-color: #f0f0f0;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .user-info strong {
            display: block;
            margin-bottom: 4px;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .btn {
            flex: 1;
            padding: 12px 16px;
            background-color: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .btn:active {
            opacity: 0.8;
        }

        .btn-secondary {
            background-color: #e0e0e0;
            color: var(--tg-theme-text-color);
        }

        .btn-secondary:active {
            background-color: #d0d0d0;
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 12px;
            flex: none;
        }

        .section {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--tg-theme-link-color);
        }

        .form-group {
            margin-bottom: 12px;
        }

        .label {
            display: block;
            font-size: 13px;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .input, .select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .input:focus, .select:focus, textarea:focus {
            outline: none;
            border-color: var(--tg-theme-link-color);
            box-shadow: 0 0 0 2px rgba(0, 136, 204, 0.1);
        }

        .list-item {
            background-color: #f9f9f9;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 4px solid var(--tg-theme-link-color);
        }

        .list-item-title {
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-item-desc {
            font-size: 13px;
            color: var(--tg-theme-hint-color);
        }

        .delete-btn {
            background: none;
            border: none;
            color: #ff6b6b;
            cursor: pointer;
            font-size: 18px;
            padding: 0;
        }

        .row-flex {
            display: flex;
            gap: 12px;
        }

        .row-flex > * {
            flex: 1;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            border-bottom: 2px solid #e0e0e0;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 10px 16px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--tg-theme-hint-color);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .tab-btn.active {
            border-bottom-color: var(--tg-theme-button-color);
            color: var(--tg-theme-button-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .search-box {
            margin-bottom: 16px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-card {
            background-color: #f0f0f0;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-card-value {
            font-size: 20px;
            font-weight: 600;
            color: var(--tg-theme-button-color);
        }

        .stat-card-label {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
            margin-top: 4px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--tg-theme-bg-color);
            border-radius: 12px;
            padding: 20px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--tg-theme-hint-color);
        }

        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            border: 1px solid #f5c6cb;
        }

        .hidden {
            display: none;
        }

        .empty-state {
            text-align: center;
            padding: 32px 16px;
            color: var(--tg-theme-hint-color);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        @media (max-width: 480px) {
            body {
                padding: 12px;
            }

            .header h1 {
                font-size: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
        <div class="header">
            <h1>üìä –£—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</h1>
            <p>–Ω–∞ –æ–±—ä–µ–∫—Ç–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</p>
        </div>

        <div id="userInfo" class="user-info hidden">
            <strong>–ú–∞—Å—Ç–µ—Ä —É—á–∞—Å—Ç–∫–∞:</strong>
            <span id="userName">-</span>
            <small id="userPhone"></small>
        </div>

        <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
        <div id="authSection">
            <div class="section">
                <div class="section-title">üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</div>
                <div class="form-group">
                    <label class="label">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –≤—Ö–æ–¥–∞:</label>
                    <div class="button-group">
                        <button class="btn" onclick="authWithTelegram()">Telegram</button>
                        <button class="btn btn-secondary" onclick="showPhoneAuth()">–¢–µ–ª–µ—Ñ–æ–Ω</button>
                    </div>
                </div>
                <div id="phoneAuthForm" class="hidden">
                    <div class="form-group">
                        <label class="label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                        <input type="tel" id="phoneInput" class="input" placeholder="+7 (XXX) XXX-XX-XX">
                    </div>
                    <div class="form-group">
                        <label class="label">–ò–º—è –º–∞—Å—Ç–µ—Ä–∞</label>
                        <input type="text" id="masterNameInput" class="input" placeholder="–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤">
                    </div>
                    <div class="button-group">
                        <button class="btn" onclick="authWithPhone()">–í–æ–π—Ç–∏</button>
                        <button class="btn btn-secondary" onclick="hidePhoneAuth()">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
        <div id="mainApp" class="hidden">
            <!-- –í–∫–ª–∞–¥–∫–∏ -->
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('objects')">–û–±—ä–µ–∫—Ç—ã</button>
                <button class="tab-btn" onclick="switchTab('records')">–ó–∞–ø–∏—Å–∏</button>
                <button class="tab-btn" onclick="switchTab('stats')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                <button class="tab-btn" onclick="switchTab('export')">–≠–∫—Å–ø–æ—Ä—Ç</button>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –û–±—ä–µ–∫—Ç—ã -->
            <div id="objectsTab" class="tab-content active">
                <div class="section">
                    <div class="section-title">üèóÔ∏è –û–±—ä–µ–∫—Ç—ã</div>
                    <div class="button-group">
                        <button class="btn" onclick="showNewObjectModal()">+ –ù–æ–≤—ã–π –æ–±—ä–µ–∫—Ç</button>
                        <button class="btn btn-secondary" onclick="toggleObjectList()">–°–ø–∏—Å–æ–∫</button>
                    </div>
                </div>

                <div id="objectsList" class="section">
                    <div id="objectsContainer"></div>
                </div>

                <div id="selectedObjectInfo" class="hidden">
                    <div class="section">
                        <div class="section-title">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–µ</div>
                        <div class="list-item">
                            <strong id="selectedObjName">-</strong>
                            <small id="selectedObjAddress">–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω</small>
                            <button class="btn btn-secondary btn-small" onclick="deleteObject()" style="margin-top: 8px;">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>

                    <!-- –õ—é–¥–∏ -->
                    <div class="section">
                        <div class="section-title">üë• –õ—é–¥–∏ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)</div>
                        <div class="form-group">
                            <input type="number" id="peoplCount" class="input" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—á–∏—Ö" min="0">
                            <button class="btn btn-secondary btn-small" onclick="addPeople()">–î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                        <div id="peopleList"></div>
                    </div>

                    <!-- –ú–µ—Ö–∞–Ω–∏–∑–º—ã -->
                    <div class="section">
                        <div class="section-title">‚öôÔ∏è –ú–µ—Ö–∞–Ω–∏–∑–º—ã</div>
                        <div class="row-flex">
                            <input type="text" id="mechanismName" class="input" placeholder="–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏">
                            <input type="number" id="mechanismHours" class="input" placeholder="–ß–∞—Å—ã">
                        </div>
                        <button class="btn btn-secondary" onclick="addMechanism()" style="margin-top: 8px;">–î–æ–±–∞–≤–∏—Ç—å</button>
                        <div id="mechanismList" style="margin-top: 12px;"></div>
                    </div>

                    <!-- –¢–æ–ø–ª–∏–≤–æ -->
                    <div class="section">
                        <div class="section-title">‚õΩ –¢–æ–ø–ª–∏–≤–æ</div>
                        <div class="form-group">
                            <input type="number" id="fuelQuantity" class="input" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—Ç—Ä–æ–≤" min="0" step="0.1">
                            <button class="btn btn-secondary" onclick="addFuel()">–î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                        <div id="fuelList"></div>
                    </div>

                    <!-- –ò–Ω–µ—Ä—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã -->
                    <div class="section">
                        <div class="section-title">ü™® –ò–Ω–µ—Ä—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</div>
                        <div class="row-flex">
                            <input type="text" id="materialType" class="input" placeholder="–í–∏–¥ –º–∞—Ç–µ—Ä–∏–∞–ª–∞">
                            <select id="materialUnit" class="select">
                                <option value="—Ç–æ–Ω–Ω—ã">–¢–æ–Ω–Ω—ã</option>
                                <option value="–∫—É–±—ã">–ö—É–±—ã</option>
                            </select>
                        </div>
                        <div class="row-flex" style="margin-top: 8px;">
                            <input type="number" id="materialQuantity" class="input" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="0" step="0.1">
                            <button class="btn btn-secondary" onclick="addMaterial()">–î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                        <div id="materialList" style="margin-top: 12px;"></div>
                    </div>

                    <!-- –ù–∞–µ–º–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ -->
                    <div class="section">
                        <div class="section-title">üöö –ù–∞–µ–º–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞</div>
                        <div class="form-group">
                            <input type="text" id="rentEquipType" class="input" placeholder="–í–∏–¥ —Ç–µ—Ö–Ω–∏–∫–∏">
                        </div>
                        <div class="row-flex">
                            <input type="number" id="rentEquipHours" class="input" placeholder="–ß–∞—Å—ã" min="0">
                            <input type="text" id="rentEquipOrg" class="input" placeholder="–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è">
                        </div>
                        <button class="btn btn-secondary" onclick="addRentEquipment()" style="margin-top: 8px;">–î–æ–±–∞–≤–∏—Ç—å</button>
                        <div id="rentEquipList" style="margin-top: 12px;"></div>
                    </div>

                    <!-- –ú–∞—à–∏–Ω—ã -->
                    <div class="section">
                        <div class="section-title">üöó –ú–∞—à–∏–Ω—ã</div>
                        <div class="row-flex">
                            <input type="text" id="carPlate" class="input" placeholder="–ì–æ—Å. –Ω–æ–º–µ—Ä">
                            <input type="number" id="carHours" class="input" placeholder="–ß–∞—Å—ã" min="0">
                        </div>
                        <button class="btn btn-secondary" onclick="addCar()" style="margin-top: 8px;">–î–æ–±–∞–≤–∏—Ç—å</button>
                        <div id="carList" style="margin-top: 12px;"></div>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –ó–∞–ø–∏—Å–∏ -->
            <div id="recordsTab" class="tab-content">
                <div class="search-box">
                    <input type="text" id="searchInput" class="input" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º...">
                    <small style="display: block; margin-top: 4px; color: var(--tg-theme-hint-color);">
                        –ò—â–∏—Ç–µ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –æ–±—ä–µ–∫—Ç–∞, —Ç–∏–ø—É –º–∞—Ç–µ—Ä–∏–∞–ª–∞, —Ç–µ—Ö–Ω–∏–∫–µ...
                    </small>
                </div>

                <div id="recordsContainer"></div>
                <div id="noRecords" class="empty-state">
                    <div class="empty-state-icon">üìù</div>
                    <div>–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div id="statsTab" class="tab-content">
                <div class="section">
                    <div class="section-title">üìà –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-value" id="totalObjects">0</div>
                            <div class="stat-card-label">–û–±—ä–µ–∫—Ç–æ–≤</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-value" id="totalRecords">0</div>
                            <div class="stat-card-label">–ó–∞–ø–∏—Å–µ–π</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-value" id="totalPeople">0</div>
                            <div class="stat-card-label">–ß–µ–ª–æ–≤–µ–∫–æ-–¥–Ω–∏</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-value" id="totalFuel">0</div>
                            <div class="stat-card-label">–õ–∏—Ç—Ä–æ–≤ —Ç–æ–ø–ª–∏–≤–∞</div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">üèóÔ∏è –ü–æ –æ–±—ä–µ–∫—Ç–∞–º</div>
                    <div id="statsContainer"></div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞: –≠–∫—Å–ø–æ—Ä—Ç -->
            <div id="exportTab" class="tab-content">
                <div class="section">
                    <div class="section-title">üì• –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</div>
                    <p style="font-size: 13px; color: var(--tg-theme-hint-color); margin-bottom: 12px;">
                        –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ Excel —Ñ–∞–π–ª –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã.
                    </p>
                    <button class="btn" onclick="exportToExcel()">üìä –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Excel</button>
                </div>

                <div class="section">
                    <div class="section-title">üóëÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</div>
                    <button class="btn btn-secondary" onclick="downloadJSON()">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é</button>
                    <button class="btn btn-secondary" style="margin-top: 12px;" onclick="showClearDataModal()">üîÑ –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
                </div>

                <div id="exportMessage"></div>
            </div>

            <!-- –í—ã—Ö–æ–¥ -->
            <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #e0e0e0;">
                <button class="btn btn-secondary" onclick="logout()" style="width: 100%;">–í—ã—Ö–æ–¥</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ù–æ–≤—ã–π –æ–±—ä–µ–∫—Ç -->
    <div id="newObjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span>–ù–æ–≤—ã–π –æ–±—ä–µ–∫—Ç</span>
                <button class="close-btn" onclick="closeModal('newObjectModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="label">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞</label>
                <input type="text" id="objectName" class="input" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –û–±—ä–µ–∫—Ç '–ù–æ–≤—ã–π –ø–∞—Ä–∫'">
            </div>
            <div class="form-group">
                <label class="label">–ê–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞</label>
                <input type="text" id="objectAddress" class="input" placeholder="–ê–¥—Ä–µ—Å —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞">
            </div>
            <div class="button-group">
                <button class="btn" onclick="createObject()">–°–æ–∑–¥–∞—Ç—å</button>
                <button class="btn btn-secondary" onclick="closeModal('newObjectModal')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏ -->
    <div id="clearDataModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span>‚ö†Ô∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?</span>
                <button class="close-btn" onclick="closeModal('clearDataModal')">&times;</button>
            </div>
            <p style="margin-bottom: 16px; font-size: 14px;">
                –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–º–µ–Ω–µ–Ω–æ.
            </p>
            <div class="button-group">
                <button class="btn" style="background-color: #ff6b6b;" onclick="clearAllData()">–£–¥–∞–ª–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="closeModal('clearDataModal')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script>
        // ============ –î–ê–ù–ù–´–ï ============
        let appData = {
            user: null,
            objects: [],
            records: []
        };

        let currentObjectId = null;

        // ============ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ============
        window.addEventListener('load', function() {
            Telegram.WebApp.ready();
            loadData();
            initTelegram();
        });

        function initTelegram() {
            const initData = Telegram.WebApp.initDataUnsafe;
            if (initData && initData.user) {
                const user = initData.user;
                appData.user = {
                    id: user.id,
                    firstName: user.first_name,
                    lastName: user.last_name || '',
                    username: user.username || '',
                    phone: user.phone_number || '',
                    authType: 'telegram'
                };
                showApp();
            }
        }

        // ============ –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ============
        function authWithTelegram() {
            const initData = Telegram.WebApp.initDataUnsafe;
            if (initData && initData.user) {
                const user = initData.user;
                appData.user = {
                    id: user.id,
                    firstName: user.first_name,
                    lastName: user.last_name || '',
                    username: user.username || '',
                    phone: user.phone_number || '',
                    authType: 'telegram'
                };
                saveData();
                showApp();
            } else {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ Telegram');
            }
        }

        function showPhoneAuth() {
            document.getElementById('phoneAuthForm').classList.remove('hidden');
        }

        function hidePhoneAuth() {
            document.getElementById('phoneAuthForm').classList.add('hidden');
        }

        function authWithPhone() {
            const phone = document.getElementById('phoneInput').value.trim();
            const name = document.getElementById('masterNameInput').value.trim();

            if (!phone || !name) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            appData.user = {
                id: 'phone_' + Date.now(),
                firstName: name,
                phone: phone,
                authType: 'phone'
            };

            saveData();
            showApp();
        }

        function showApp() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            updateUserInfo();
            loadObjects();
        }

        function updateUserInfo() {
            if (appData.user) {
                const name = appData.user.firstName + (appData.user.lastName ? ' ' + appData.user.lastName : '');
                document.getElementById('userName').textContent = name;
                if (appData.user.phone) {
                    document.getElementById('userPhone').textContent = appData.user.phone;
                }
            }
        }

        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                appData.user = null;
                currentObjectId = null;
                saveData();
                location.reload();
            }
        }

        // ============ –û–ë–™–ï–ö–¢–´ ============
        function showNewObjectModal() {
            document.getElementById('objectName').value = '';
            document.getElementById('objectAddress').value = '';
            document.getElementById('newObjectModal').classList.add('active');
        }

        function createObject() {
            const name = document.getElementById('objectName').value.trim();
            const address = document.getElementById('objectAddress').value.trim();

            if (!name) {
                alert('–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞');
                return;
            }

            const object = {
                id: Date.now().toString(),
                name: name,
                address: address,
                createdAt: new Date().toISOString(),
                data: {
                    people: [],
                    mechanisms: [],
                    fuel: [],
                    materials: [],
                    rentEquipment: [],
                    cars: []
                }
            };

            appData.objects.push(object);
            saveData();
            closeModal('newObjectModal');
            loadObjects();
        }

        function loadObjects() {
            const container = document.getElementById('objectsContainer');
            container.innerHTML = '';

            if (appData.objects.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üèóÔ∏è</div><div>–ù–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤</div></div>';
                return;
            }

            appData.objects.forEach(obj => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.onclick = () => selectObject(obj.id);
                item.innerHTML = `
                    <div class="list-item-title">
                        <span>${obj.name}</span>
                        <button class="delete-btn" onclick="event.stopPropagation(); deleteObject('${obj.id}')">üóëÔ∏è</button>
                    </div>
                    <div class="list-item-desc">
                        üìç ${obj.address || '–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω'}<br>
                        üìÖ ${new Date(obj.createdAt).toLocaleDateString('ru-RU')}
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function selectObject(objId) {
            currentObjectId = objId;
            const obj = appData.objects.find(o => o.id === objId);
            if (obj) {
                document.getElementById('selectedObjName').textContent = obj.name;
                document.getElementById('selectedObjAddress').textContent = obj.address || '–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω';
                document.getElementById('selectedObjectInfo').classList.remove('hidden');
                refreshObjectData();
            }
        }

        function deleteObject(objId) {
            objId = objId || currentObjectId;
            if (!objId || !confirm('–£–¥–∞–ª–∏—Ç—å –æ–±—ä–µ–∫—Ç –∏ –≤—Å–µ –µ–≥–æ –¥–∞–Ω–Ω—ã–µ?')) return;

            appData.objects = appData.objects.filter(o => o.id !== objId);
            appData.records = appData.records.filter(r => r.objectId !== objId);
            saveData();

            if (currentObjectId === objId) {
                currentObjectId = null;
                document.getElementById('selectedObjectInfo').classList.add('hidden');
            }

            loadObjects();
        }

        // ============ –õ–Æ–î–ò ============
        function addPeople() {
            const count = parseInt(document.getElementById('peoplCount').value) || 0;
            if (count <= 0) {
                alert('–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ');
                return;
            }

            if (currentObjectId) {
                const obj = appData.objects.find(o => o.id === currentObjectId);
                if (obj) {
                    const entry = {
                        id: Date.now().toString(),
                        count: count,
                        date: new Date().toLocaleString('ru-RU')
                    };
                    obj.data.people.push(entry);
                    saveData();
                    document.getElementById('peoplCount').value = '';
                    refreshObjectData();
                    showMessage('–õ—é–¥–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã');
                }
            }
        }

        // ============ –ú–ï–•–ê–ù–ò–ó–ú–´ ============
        function addMechanism() {
            const name = document.getElementById('mechanismName').value.trim();
            const hours = parseFloat(document.getElementById('mechanismHours').value) || 0;

            if (!name) {
                alert('–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏');
                return;
            }

            if (currentObjectId) {
                const obj = appData.objects.find(o => o.id === currentObjectId);
                if (obj) {
                    const entry = {
                        id: Date.now().toString(),
                        name: name,
                        hours: hours,
                        date: new Date().toLocaleString('ru-RU')
                    };
                    obj.data.mechanisms.push(entry);
                    saveData();
                    document.getElementById('mechanismName').value = '';
                    document.getElementById('mechanismHours').value = '';
                    refreshObjectData();
                    showMessage('–ú–µ—Ö–∞–Ω–∏–∑–º –¥–æ–±–∞–≤–ª–µ–Ω');
                }
            }
        }

        // ============ –¢–û–ü–õ–ò–í–û ============
        function addFuel() {
            const quantity = parseFloat(document.getElementById('fuelQuantity').value) || 0;

            if (quantity <= 0) {
                alert('–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—Ç—Ä–æ–≤');
                return;
            }

            if (currentObjectId) {
                const obj = appData.objects.find(o => o.id === currentObjectId);
                if (obj) {
                    const entry = {
                        id: Date.now().toString(),
                        liters: quantity,
                        date: new Date().toLocaleString('ru-RU')
                    };
                    obj.data.fuel.push(entry);
                    saveData();
                    document.getElementById('fuelQuantity').value = '';
                    refreshObjectData();
                    showMessage('–¢–æ–ø–ª–∏–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ');
                }
            }
        }

        // ============ –ò–ù–ï–†–¢–ù–´–ï –ú–ê–¢–ï–†–ò–ê–õ–´ ============
        function addMaterial() {
            const type = document.getElementById('materialType').value.trim();
            const quantity = parseFloat(document.getElementById('materialQuantity').value) || 0;
            const unit = document.getElementById('materialUnit').value;

            if (!type || quantity <= 0) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            if (currentObjectId) {
                const obj = appData.objects.find(o => o.id === currentObjectId);
                if (obj) {
                    const entry = {
                        id: Date.now().toString(),
                        type: type,
                        quantity: quantity,
                        unit: unit,
                        date: new Date().toLocaleString('ru-RU')
                    };
                    obj.data.materials.push(entry);
                    saveData();
                    document.getElementById('materialType').value = '';
                    document.getElementById('materialQuantity').value = '';
                    refreshObjectData();
                    showMessage('–ú–∞—Ç–µ—Ä–∏–∞–ª –¥–æ–±–∞–≤–ª–µ–Ω');
                }
            }
        }

        // ============ –ù–ê–ï–ú–ù–ê–Ø –¢–ï–•–ù–ò–ö–ê ============
        function addRentEquipment() {
            const type = document.getElementById('rentEquipType').value.trim();
            const hours = parseFloat(document.getElementById('rentEquipHours').value) || 0;
            const org = document.getElementById('rentEquipOrg').value.trim();

            if (!type || hours <= 0 || !org) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            if (currentObjectId) {
                const obj = appData.objects.find(o => o.id === currentObjectId);
                if (obj) {
                    const entry = {
                        id: Date.now().toString(),
                        type: type,
                        hours: hours,
                        organization: org,
                        date: new Date().toLocaleString('ru-RU')
                    };
                    obj.data.rentEquipment.push(entry);
                    saveData();
                    document.getElementById('rentEquipType').value = '';
                    document.getElementById('rentEquipHours').value = '';
                    document.getElementById('rentEquipOrg').value = '';
                    refreshObjectData();
                    showMessage('–ù–∞–µ–º–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
                }
            }
        }

        // ============ –ú–ê–®–ò–ù–´ ============
        function addCar() {
            const plate = document.getElementById('carPlate').value.trim();
            const hours = parseFloat(document.getElementById('carHours').value) || 0;

            if (!plate || hours <= 0) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            if (currentObjectId) {
                const obj = appData.objects.find(o => o.id === currentObjectId);
                if (obj) {
                    const entry = {
                        id: Date.now().toString(),
                        plate: plate,
                        hours: hours,
                        date: new Date().toLocaleString('ru-RU')
                    };
                    obj.data.cars.push(entry);
                    saveData();
                    document.getElementById('carPlate').value = '';
                    document.getElementById('carHours').value = '';
                    refreshObjectData();
                    showMessage('–ú–∞—à–∏–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
                }
            }
        }

        // ============ –û–ë–ù–û–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–• –û–ë–™–ï–ö–¢–ê ============
        function refreshObjectData() {
            if (!currentObjectId) return;

            const obj = appData.objects.find(o => o.id === currentObjectId);
            if (!obj) return;

            // –õ—é–¥–∏
            const peopleContainer = document.getElementById('peopleList');
            peopleContainer.innerHTML = '';
            obj.data.people.forEach((p, i) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div class="list-item-title">
                        <span>${p.count} —á–µ–ª–æ–≤–µ–∫</span>
                        <button class="delete-btn" onclick="deleteEntry('people', ${i})">üóëÔ∏è</button>
                    </div>
                    <small>${p.date}</small>
                `;
                peopleContainer.appendChild(div);
            });

            // –ú–µ—Ö–∞–Ω–∏–∑–º—ã
            const mechanismContainer = document.getElementById('mechanismList');
            mechanismContainer.innerHTML = '';
            obj.data.mechanisms.forEach((m, i) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div class="list-item-title">
                        <span>${m.name}: ${m.hours} —á.</span>
                        <button class="delete-btn" onclick="deleteEntry('mechanisms', ${i})">üóëÔ∏è</button>
                    </div>
                    <small>${m.date}</small>
                `;
                mechanismContainer.appendChild(div);
            });

            // –¢–æ–ø–ª–∏–≤–æ
            const fuelContainer = document.getElementById('fuelList');
            fuelContainer.innerHTML = '';
            obj.data.fuel.forEach((f, i) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div class="list-item-title">
                        <span>${f.liters} –ª. —Ç–æ–ø–ª–∏–≤–∞</span>
                        <button class="delete-btn" onclick="deleteEntry('fuel', ${i})">üóëÔ∏è</button>
                    </div>
                    <small>${f.date}</small>
                `;
                fuelContainer.appendChild(div);
            });

            // –ò–Ω–µ—Ä—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
            const materialContainer = document.getElementById('materialList');
            materialContainer.innerHTML = '';
            obj.data.materials.forEach((m, i) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div class="list-item-title">
                        <span>${m.type}: ${m.quantity} ${m.unit}</span>
                        <button class="delete-btn" onclick="deleteEntry('materials', ${i})">üóëÔ∏è</button>
                    </div>
                    <small>${m.date}</small>
                `;
                materialContainer.appendChild(div);
            });

            // –ù–∞–µ–º–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞
            const rentContainer = document.getElementById('rentEquipList');
            rentContainer.innerHTML = '';
            obj.data.rentEquipment.forEach((r, i) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div class="list-item-title">
                        <span>${r.type}: ${r.hours} —á.</span>
                        <button class="delete-btn" onclick="deleteEntry('rentEquipment', ${i})">üóëÔ∏è</button>
                    </div>
                    <div class="list-item-desc">
                        –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: ${r.organization}<br>
                        ${r.date}
                    </div>
                `;
                rentContainer.appendChild(div);
            });

            // –ú–∞—à–∏–Ω—ã
            const carContainer = document.getElementById('carList');
            carContainer.innerHTML = '';
            obj.data.cars.forEach((c, i) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div class="list-item-title">
                        <span>${c.plate}: ${c.hours} —á.</span>
                        <button class="delete-btn" onclick="deleteEntry('cars', ${i})">üóëÔ∏è</button>
                    </div>
                    <small>${c.date}</small>
                `;
                carContainer.appendChild(div);
            });
        }

        function deleteEntry(type, index) {
            if (!currentObjectId) return;

            const obj = appData.objects.find(o => o.id === currentObjectId);
            if (obj && obj.data[type]) {
                obj.data[type].splice(index, 1);
                saveData();
                refreshObjectData();
            }
        }

        // ============ –í–ö–õ–ê–î–ö–ê –ó–ê–ü–ò–°–ò ============
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));

            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'records') {
                loadRecords();
            } else if (tabName === 'stats') {
                loadStats();
            }
        }

        function loadRecords() {
            const container = document.getElementById('recordsContainer');
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            
            let records = [];
            appData.objects.forEach(obj => {
                ['people', 'mechanisms', 'fuel', 'materials', 'rentEquipment', 'cars'].forEach(type => {
                    obj.data[type].forEach(entry => {
                        records.push({
                            objectName: obj.name,
                            objectId: obj.id,
                            type: type,
                            ...entry
                        });
                    });
                });
            });

            // –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–∏—Å–∫—É
            if (searchInput) {
                records = records.filter(r => {
                    const text = JSON.stringify(r).toLowerCase();
                    return text.includes(searchInput);
                });
            }

            container.innerHTML = '';
            if (records.length === 0) {
                document.getElementById('noRecords').classList.remove('hidden');
                return;
            }

            document.getElementById('noRecords').classList.add('hidden');

            records.forEach(r => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `
                    <div class="list-item-title">
                        <span>${getRecordTitle(r)}</span>
                    </div>
                    <div class="list-item-desc">
                        <strong>${r.objectName}</strong><br>
                        üìÖ ${r.date}
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function getRecordTitle(record) {
            const types = {
                people: `üë• ${record.count} —á–µ–ª–æ–≤–µ–∫`,
                mechanisms: `‚öôÔ∏è ${record.name} (${record.hours}—á)`,
                fuel: `‚õΩ ${record.liters}–ª —Ç–æ–ø–ª–∏–≤–∞`,
                materials: `ü™® ${record.type} (${record.quantity}${record.unit})`,
                rentEquipment: `üöö ${record.type} (${record.hours}—á, ${record.organization})`,
                cars: `üöó ${record.plate} (${record.hours}—á)`
            };
            return types[record.type] || '–ó–∞–ø–∏—Å—å';
        }

        // ============ –í–ö–õ–ê–î–ö–ê –°–¢–ê–¢–ò–°–¢–ò–ö–ê ============
        function loadStats() {
            let totalObjects = appData.objects.length;
            let totalPeople = 0;
            let totalFuel = 0;
            let totalRecords = 0;

            const statsContainer = document.getElementById('statsContainer');
            statsContainer.innerHTML = '';

            appData.objects.forEach(obj => {
                totalPeople += obj.data.people.reduce((sum, p) => sum + p.count, 0);
                totalFuel += obj.data.fuel.reduce((sum, f) => sum + f.liters, 0);
                totalRecords += Object.values(obj.data).reduce((sum, arr) => sum + arr.length, 0);

                const objStats = `
                    <div class="list-item">
                        <strong>${obj.name}</strong>
                        <div class="stat-card" style="margin-top: 8px; background: white;">
                            üë• –õ—é–¥–∏: ${obj.data.people.reduce((s, p) => s + p.count, 0)} | 
                            ‚öôÔ∏è –ú–µ—Ö–∞–Ω–∏–∑–º—ã: ${obj.data.mechanisms.length} | 
                            ‚õΩ –¢–æ–ø–ª–∏–≤–æ: ${obj.data.fuel.reduce((s, f) => s + f.liters, 0).toFixed(1)}–ª | 
                            ü™® –ú–∞—Ç–µ—Ä–∏–∞–ª—ã: ${obj.data.materials.length}
                        </div>
                    </div>
                `;
                statsContainer.innerHTML += objStats;
            });

            document.getElementById('totalObjects').textContent = totalObjects;
            document.getElementById('totalRecords').textContent = totalRecords;
            document.getElementById('totalPeople').textContent = totalPeople;
            document.getElementById('totalFuel').textContent = totalFuel.toFixed(1);
        }

        // ============ –≠–ö–°–ü–û–†–¢ –í EXCEL ============
        function exportToExcel() {
            // –°–æ–∑–¥–∞–µ–º CSV —Ñ–æ—Ä–º–∞—Ç (—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å Excel)
            let csv = '–û–±—ä–µ–∫—Ç,–¢–∏–ø,–î–∞–Ω–Ω—ã–µ,–î–∞—Ç–∞\n';

            appData.objects.forEach(obj => {
                obj.data.people.forEach(p => {
                    csv += `"${obj.name}","–õ—é–¥–∏","${p.count} —á–µ–ª–æ–≤–µ–∫","${p.date}"\n`;
                });
                obj.data.mechanisms.forEach(m => {
                    csv += `"${obj.name}","–ú–µ—Ö–∞–Ω–∏–∑–º","${m.name} - ${m.hours}—á","${m.date}"\n`;
                });
                obj.data.fuel.forEach(f => {
                    csv += `"${obj.name}","–¢–æ–ø–ª–∏–≤–æ","${f.liters}–ª","${f.date}"\n`;
                });
                obj.data.materials.forEach(m => {
                    csv += `"${obj.name}","–ú–∞—Ç–µ—Ä–∏–∞–ª","${m.type} - ${m.quantity}${m.unit}","${m.date}"\n`;
                });
                obj.data.rentEquipment.forEach(r => {
                    csv += `"${obj.name}","–ù–∞–µ–º–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞","${r.type} - ${r.hours}—á (${r.organization})","${r.date}"\n`;
                });
                obj.data.cars.forEach(c => {
                    csv += `"${obj.name}","–ú–∞—à–∏–Ω–∞","${c.plate} - ${c.hours}—á","${c.date}"\n`;
                });
            });

            // –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `export_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showMessage('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ CSV —Ñ–∞–π–ª', 'success');
        }

        function downloadJSON() {
            const json = JSON.stringify(appData, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `backup_${new Date().toISOString().split('T')[0]}.json`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showMessage('–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–∫–∞—á–∞–Ω–∞', 'success');
        }

        function showClearDataModal() {
            document.getElementById('clearDataModal').classList.add('active');
        }

        function clearAllData() {
            appData.objects = [];
            saveData();
            closeModal('clearDataModal');
            loadObjects();
            showMessage('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã', 'success');
        }

        // ============ –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ============
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        };

        // ============ –•–†–ê–ù–ò–õ–ò–©–ï ============
        function saveData() {
            localStorage.setItem('appData', JSON.stringify(appData));
        }

        function loadData() {
            const saved = localStorage.getItem('appData');
            if (saved) {
                appData = JSON.parse(saved);
            }
        }

        // ============ UI –ü–û–ú–û–©–ù–ò–ö–ò ============
        function showMessage(msg, type = 'info') {
            const msg_div = document.createElement('div');
            msg_div.className = type === 'success' ? 'success-message' : 'error-message';
            msg_div.textContent = msg;
            msg_div.style.position = 'fixed';
            msg_div.style.top = '10px';
            msg_div.style.left = '10px';
            msg_div.style.right = '10px';
            msg_div.style.zIndex = '2000';
            document.body.appendChild(msg_div);

            setTimeout(() => {
                msg_div.remove();
            }, 3000);
        }

        function toggleObjectList() {
            const list = document.getElementById('objectsList');
            list.style.display = list.style.display === 'none' ? 'block' : 'none';
        }

        document.getElementById('searchInput').addEventListener('input', loadRecords);
    </script>
</body>
</html>
